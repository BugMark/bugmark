#!/usr/bin/env ruby

require './config/environment'

json = File.read('script/data/github_xdmarket.json')

repo_name = "mvscorg/xdmarket"

Repo.find_by_name(repo_name).try(:destroy)

repo = Repo.create(name: repo_name, format: "GitHub")

JSON.parse(json).each do |el|
  attrs = {
    api_url:   el["url"]       ,
    http_url:  el["http_url"]  ,
    repo_id:   repo.id         ,
    title:     el["title"]     ,
    labels:    el["labels"]    ,
    status:    el["state"]     ,
    synced_at: Time.now
  }
  Issue.create attrs
end
